<?php
// السماح للمشغل بالاتصال من أي مصدر
header("Access-Control-Allow-Origin: *");

// استقبال القيم من الرابط
$mac = $_GET['mac'] ?? '';
$stream = $_GET['stream'] ?? '';
$ext = $_GET['ext'] ?? 'm3u8';

// بناء الرابط الأصلي
$originalUrl = "http://maho2025.xyz/play/live.php?mac={$mac}&stream={$stream}&extension={$ext}";

// ترويسات مطابقة للمتصفح الحقيقي
$opts = [
    "http" => [
        "header" =>
            "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36\r\n" .
            "Accept: */*\r\n" .
            "Accept-Language: ar-AE,ar;q=0.9,en;q=0.8\r\n" .
            "Connection: keep-alive\r\n"
    ]
];

$context = stream_context_create($opts);

// فتح تدفق القناة من السيرفر الأصلي
$streamData = @fopen($originalUrl, 'rb', false, $context);

if ($streamData) {
    header("Content-Type: application/vnd.apple.mpegurl");
    fpassthru($streamData);
    fclose($streamData);
} else {
    http_response_code(404);
    echo "⚠️ القناة غير متوفرة حالياً.";
}
?>
